# MongoDB 复制

> 原文:[https://www.tutorialandexample.com/mongodb-replication/](https://www.tutorialandexample.com/mongodb-replication/)

**MongoDB 复制**

复制通常是指制作相同数据的副本。在 MongoDB 中，它确保相同数据在多个服务器中的可用性。因此，如果由于任何原因 MongoDB 的主数据库服务器出现故障，您可以很容易地从任何其他拥有相同副本的服务器上访问复制的数据。它还通过确保对数据库的保护，定期提高数据可用性。

### 复制的优势

1.  **确保数据安全** -即使主服务器出现故障，数据也不会丢失，因为复制的副本存储在其他服务器上。
2.  **提高数据可用性**-由于多个副本存储在多个服务器中，用户可以随时访问数据。
3.  **轻松从任何灾难中恢复**-由于多个服务器中存在额外的副本，因此从崩溃、火灾等灾难中恢复非常容易。
4.  **不需要额外时间** -维护不需要额外时间。
5.  **读取操作从任何复制副本开始，无需等待** -这增加了读取比例。负载得到了很好的平衡，因为所有用户都连接到所有服务器，而不是连接到单个系统。
6.  副本集对应用程序的透明性。

### MongoDB-副本集

复制是通过创建副本集完成的。副本集是包含多个 MongoDB 服务器或 mongod 实例的集，它们拥有相同的数据集。它有一个主节点，接受来自客户端的所有写操作。其余的实例称为辅助节点，在这些节点中只执行读取操作。

### 副本集的特征

1.  副本集至少需要三个节点。
2.  副本集中只有一个节点是主节点，其余的都是辅助节点。
3.  写操作后，数据从主节点复制到辅助节点
4.  如果发生任何灾难，则在协商一致选举之后，从辅助实例分配新的主节点。
5.  故障节点恢复后，它再次成为集合的一部分，但作为辅助节点。

### 副本集创建

1.  在不同的服务器上安装 mongod.exe 实例。这确保了任何一个实例的失败都可以维持其他实例的可用性。
2.  确保所有实例都可以连接。

**语法**:

```
mongod --port "PORT_Number" --dbpath "Mention_DB_Data_Path" --replSet "Named_Replica_Set_Instance"
```

**示例:**从第一个服务器(假设是 X)发出以下命令:

```
mongod –port27017 –dbpath “C:setup\mongodb\data”—replset rs1
```

当您设置副本集时，该命令将按以下方式工作:

*   首先，MongoDB 实例以名称 rs1 开始，默认端口号为 27017。
*   在命令提示符的帮助下，连接到这个实例。
*   要启动一个新的副本集，在主服务器上执行命令 **rs.initiate()** 。
*   执行命令 **rs.conf()，**来检查副本集配置。
*   最后执行命令 **rs.status()，**来检查副本集的状态。

3.通过启动第一个 mongod.exe 实例，对副本集的所有服务器进行分组。

mongo–repl set“rs1”

**在副本集中添加服务器:**

在 mongoDB 客户端发出命令 **rs.add()**

语法:rs.add(主机名:端口)

如果我们有三台服务器，即 X、Y 和 Z，并且如果 X 是主服务器，那么 Y 和 Z 可以通过

**rs1.add(ServerY")**

**rs1.add("ServerZ")**

连接到主节点后，可以添加实例。**客户端节点中的 Db.isMaster()** 命令有助于检查您与主节点的连接。

**从副本集中删除服务器**

我们可以通过执行 **rs.remove()** 命令从配置集中删除任何服务器。要执行 rs.remove()，请按照下列步骤操作:

1.  关闭需要删除的实例。要关闭，请在 mongo shell 上执行以下命令:

**数据库关闭服务器**

*   确保您已连接到主服务器。

在给定命令中指定要从集中删除的服务器名称。

**rs.remove("服务器名称")**

如果副本集在服务器 X、服务器 Y 和服务器 Z 上，并且我们希望从指定的副本集中删除服务器 Y，请执行以下命令:

**rs.remove("ServerY")**

这样，我们可以根据需求管理(添加或删除)副本集的 MongoDB 实例&我们可以增加相同数据在多个 MongoDB 服务器上的可用性。