# 系统设计中的缓存

> 原文：<https://www.tutorialandexample.com/caching-in-system-design>

在网上冲浪时，你通常会奇怪为什么你曾经访问过的网站比新的网站加载得更快。

你还会注意到，与高质量的图片或其他组件相比，网站上的文本和标签的显示或加载速度更快。这背后的原因是缓存。

如果你曾经访问过 Instagram 或 Twitter 等数据连接缓慢的社交媒体平台，你会发现与标题或文本相比，帖子需要更长的时间来加载。对于大公司和企业来说，这些事情非常重要，因为这些活动会让用户一直参与到图像完全加载为止，防止他们从一个网页切换到另一个网页。如果网站加载时间比平时长，客户可能会立即更改网站。更好的客户体验可以避免企业失去现有客户，并帮助他们在市场中站稳脚跟。

例如，当你在任何流媒体平台上观看视频时，如果视频缓冲，你会选择切换平台或搜索其他方式来娱乐自己。

使用众所周知的高速缓存技术，可以很容易地解决与参与和增强这种业务的用户体验相关的所有这些问题。

## 缓存技术

您可能会问，缓存技术背后的基本思想或逻辑是什么？

让我们这样想，当你准备晚餐时，你是站在超市里买日常常用的基本调料，还是把它们放在厨房里？

唯一合理且显而易见的答案是把它们放在厨房里，这样可以节省每天逛超市的时间和精力。

这正是缓存的概念。在这个类比中，厨房搁板的工作方式类似于系统中的缓存寄存器或临时存储器。当我们的系统需要从主内存 RAM 中获取一些数据时，也会发生同样的事情。重复访问数据，即使是从主存储器中，也是一项具有挑战性的任务。通过将频繁使用的数据存储在更快且更容易访问的存储系统(即高速缓冲存储器)中，可以减少获取所需数据的总时间。

高速缓冲存储器只是用来存储临时数据的寄存器的集合，这些寄存器的存储空间有限，但是它比任何其他存储系统都要快得多。缓存用于存储最近访问的项目。

因此，如果你需要在同一个程序中重复使用一条信息，把它保存在缓存中，这样更容易反复存储。

你们中的大多数人现在可能会想，如果高速缓存有这么大的好处，为什么不用它来存储所有的数据呢？这背后有各种原因，其中一个主要原因是用于存储高速缓存的硬件与常规存储设备相比极其昂贵；此外，如果我们也用大量数据填充缓存，这只会破坏它们更快、更容易访问的真正原因，因此只有最近可访问的数据才应该存储在缓存中。

### 我们如何在他们的系统中使用缓存？

缓存几乎应用于 IT 领域的每一层。系统硬件中有三层高速缓存，第一层是 CPU 高速缓存，第二层是高速缓存，最后一层是常规 RAM。

操作系统中也需要高速缓冲存储器来缓存内核的各种实例，以处理它们不同的扩展。

web 浏览器中也提供了高速缓存以提供更好的用户体验。

通过存储您经常访问的网站的数据

移动和 web 应用程序中的缓存用于保存前端的属性，以便它可以更快地加载，并且更容易被用户访问。

在一个设计良好的系统中，高速缓冲存储器被放置在靠近中央处理器的地方，有时在 CPU 芯片上。高速缓冲存储器通过数据总线网络连接到系统，高速缓冲存储器减少了延迟并增强了输入/输出操作。

## 缓存是如何工作的？

通常，web 应用程序会将最近用户的数据存储回数据库中。要在数据库上执行的读写操作需要网络调用和输入/输出操作。

高速缓存帮助您避免这种不必要的拥挤

高速缓存通过减少对数据库的网络调用来提高服务质量。为了更好地理解这个概念，让我们以任何社交媒体平台为例。例如，假设一个帖子像病毒一样传播开来，成为热门话题。现在成千上万的用户想要访问同一个文件

从数据库中检索每个请求的数据是不明智的。

这些社交媒体平台拥有数百万用户，仅检索一个文件就需要这么大的流量会降低用户体验。为了减少流量和节省时间，我们可以将这些频繁访问的项目分别保存在缓存中，这将有助于我们提高机器的性能。

在一个典型的 web 应用程序中，我们使用 Redis 等应用服务器的内存存储来添加一些服务器缓存，这可能有助于提高我们机器的性能。

## 缓存类型

通常，您可以通过以下四种方式在系统中实现缓存:

### 1.应用服务器缓存

在设计 web 应用程序时，通过在 web 服务器上给应用程序服务器缓存提供一些内存存储，可以很容易地添加应用程序服务器缓存。这种类型的缓存被称为应用服务器缓存，因为它是在应用服务器上实现的。当 web 应用程序中使用的服务器只有一个节点时，可以将缓存添加到应用服务器的内存中。

然后，用户的最新请求存储在缓存中，如果重复，则直接从缓存中获取数据，而不是在数据库中搜索。如果用户发送任何新的请求，将从磁盘中获取该请求的信息，并存储在缓存中以供后续使用。

注意，缓存会占用 web 服务器的内存空间，这也会影响机器的性能。

对于小型系统来说，应用服务器缓存是一个很好的解决方案，但是当您需要扩展应用程序时，主要问题就出现了。如果缓存仍然在应用服务器上工作，随着服务器数量的增加，缓存未命中的数量也会增加。由于负载平衡器将用于将请求路由到服务器，每个节点将完全不知道已经缓存的请求，这使得数据不一致并增加了复杂性。您可以在设计中使用全局或分布式来解决这个问题。现在让我们分别来看看它们。

### 2.全局缓存

顾名思义，全局缓存是在单个缓存空间中实现的。应用程序中的每个节点都将使用相同的空间来存储缓存的请求。全局缓存可以分为两个部分:

首先，当在全局缓存空间中找不到所请求的数据时，缓存负责从磁盘或数据库中的任何地方找到所请求的数据。

第二，当在缓存空间中找不到数据时，请求节点直接联系数据库或磁盘以从中检索数据。

### 3.分布式缓存

在设计具有多个服务器的应用程序时，可以使用分布式缓存。顾名思义，整个缓存分布在整个网络中，每个节点将被分配一部分缓存。负载平衡器遇到的每个请求都被路由到最有可能找到缓存请求的服务器；使用一致的散列函数来决定服务器，每个请求在被路由之前通过该函数。

**要点:**

*   每个节点都有一部分缓存。
*   请求将被路由到的服务器是通过一致散列函数传递每个请求来决定的
*   只需在应用程序设计中添加更多的服务器，就可以增加缓存空间。

### 4.内容分发网络

**CDN** 基本上是用来减少服务器上的网络流量。CDN 主要用于提供大量静态数据的网站。静态数据可以是来自 HTML、javascript 文件甚至标准图像的任何东西。首先，我们从 CDN 请求数据，只有在 CDN 上不可用时，才向后端服务请求数据。

## 缓存失效

缓存是提升系统性能的一个很好的解决方案，但是让我们假设一个场景，用户在数据库上执行持续的写操作。现在，如果数据库不断更新，所有服务器或节点应该访问相同的数据并保持一致性。尽管如此，缓存仍然会产生问题，因为保持每台服务器上所有缓存内存的一致性是一项挑战。

我们使用一些缓存失效方法来使缓存数据失效，以避免不一致的应用程序行为，并保持缓存数据与源数据库一致。

有三种类型的缓存失效方法，例如:

### 1.直写缓存

顾名思义，写操作是通过缓存执行的，这意味着任何写操作都将首先在缓存上执行，然后在数据库上执行，以保持一致性。如果发现任何读取请求，可以直接在高速缓存上执行，因为每次读取都在最近的写入操作之后。

这种方法的众多优点之一是，由于对缓存和实际数据库的写操作是同时进行的，因此这在很大程度上降低了缓存更新所涉及的风险。直写缓存技术可用于那些需要在将数据写入数据库后重复读取数据的应用，因为在此类系统中，写入操作可能需要较长的时间，这将由我们缓存的低读取延迟和一致性来补偿。

### 2.绕写缓存

与直写缓存技术不同，在这种方法中，我们将数据写入数据库，而不更新或更改缓存。然而，这将有助于更快地执行写操作；这可能会导致高速缓存中的数据不一致。这种方法的主要缺点是，来自最近读取操作的读取请求可能会导致缓存未命中，并且必须从较慢的后端读取。您不需要加载缓存数据，这些数据不会被重新读取；因此，这种方法最适合不重新读取最新写入数据的应用程序。

### 3.回写缓存

这种方法解决了您在实现直写或绕写缓存技术时可能面临的问题。由于更新缓存和数据库会增加写入延迟，因此仅更新数据库可能会导致数据不一致。在这种方法中，我们只首先更新缓存，并为其分配一个修改后的状态。我们定期安排一些异步作业，以便用正确的数据进一步更新数据库。

这种方法的唯一缺点是数据丢失的风险很高。假设您已经更新了缓存，并且正在等待对数据库进行写操作，但是突然磁盘崩溃，缓存中的所有数据都丢失了，现在，由于数据库是真实数据的来源，并且数据尚未写入其中，所以您已经丢失了数据。

## 驱逐技术

我们已经看到了系统设计中与缓存相关的大多数基本概念。但是您可能想知道，如果系统中的高速缓存变满了，您会怎么办。由于系统中的高速缓存是有限的，所以您必须使用某种逐出算法来用新数据替换高速缓存中的现有数据，并且应该以最少的高速缓存未命中的方式来完成。

现在让我们了解一些常用的缓存回收方法:

### 1.最近最少使用(LRU)

LRU 是最直接的方法之一，因此也是最受欢迎的方法。该技术在标准系统中具有良好的运行时性能和合理的命中率。

顾名思义，最近最少使用的缓存片段会被新的写请求替换或覆盖。每当一个新的条目出现时，最底部的数据被删除，最新的条目被写入顶部。

看看任何社交媒体平台的例子。当新帖子到达时，最旧的帖子会从主页中删除，最新的帖子会显示在顶部。

### 2.最不常用

在这种方法中，最不常用的缓存片段会被删除，然后发出最新的写请求。以你在手机上打字时得到的建议为例；这些单词是存储在设备缓存中最常用的单词。

### 3.最近使用的

这种方法适用于最近更新的数据最不可能被重新读取的应用程序。这种方法从缓存中删除最近读取的数据，而倾向于保留旧数据。在大多数应该避免数据重复以改善用户体验的应用程序中，这种方法用于存储您已经交互过的数据。

### 4.随机替换

随机替换是最直接的方法，因为它只是替换任何随机缓存碎片，为新数据腾出必要的空间。

这就是你应该知道的关于系统设计中缓存概念的一切。